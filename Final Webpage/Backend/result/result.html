
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Analiza Extras de Cont</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
</head>
<body>

<div id="cheltuieliPeZile" style="width:600px;height:400px;"></div>
<div id="cheltuieliPeComercianti" style="width:600px;height:400px;"></div>
<div id="totalCheltuitiPrimit" style="width:600px;height:400px;"></div>
<div id="primiriPeOrigine" style="width:600px;height:400px;"></div>
<div id="cheltuieliPeCategorii" style="width:600px;height:400px;"></div>


<script>
// Datele din extrasul de cont (exemplu)
const tranzactii = [
    {data: "02-04-2023", explicatie: "Tranzactie comerciant - Tranz:Nr card 546805XXXXXXX3954, Ref 548107040357 Nota contabila 92.88 RON. Comision: 0 RON. Locatie: POS21671 RO COBYUL SRL-IASI Data_Ora: 31-03-2023 15:20:56", debit: 95.30, credit: 0.00},
    {data: "02-04-2023", explicatie: "Tranzactie comerciant - Tranz:Nr card 546805XXXXXXX3954, Ref 548123811509 Nota contabila 39.44 RON. Comision: 0 RON. Locatie: 61716350 RO LCL RO-139 IASI Data_Ora: 01-04-2023 13:04:12", debit: 39.44, credit: 0.00},
    {data: "03-04-2023", explicatie: "Comision Tranzactie card de debit prin curier", debit: 10.00, credit: 0.00},
    {data: "03-04-2023", explicatie: "Tranzactie comerciant - Tranz:Nr card 546805XXXXXXX3954, Ref 548148118388 Suma platita 17.97 RON. Comision: 0 RON. Locatie: 22051080 RO LEROY MERLIN ROVANA S IASI. Data_Ora: 02-04-2023 16:25:23", debit: 17.97, credit: 0.00},
    {data: "04-04-2023", explicatie: "Tranzactie comerciant - Tranz:Nr card 546805XXXXXXX3954, Ref 548169260001 Nota contabila 82.98 RON. Comision: 0 RON. Locatie: 61716156 RO LCL RO-139 IASI. Data_Ora: 03-04-2023 19:13:08", debit: 82.98, credit: 0.00},
    {data: "01-07-2023", explicatie: "Retail Irish Pub", debit: 169.20, credit: 0.00},
    {data: "04-07-2023", explicatie: "BlaBlaCar", debit: 8.00, credit: 0.00},
    {data: "06-07-2023", explicatie: "BlaBlaCar", debit: 9.00, credit: 0.00},
    {data: "25-07-2023", explicatie: "Viva Credit", debit: 0.10, credit: 0.00}

];

// Functii de utilitate
function getZiSaptamana(data) {
    const dateParts = data.split('-');
    const dataObj = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]);
    const ziua = dataObj.getDay();  // 0=Duminica, 1=Luni, ..., 6=Sambata
    const zileleSaptamanii = ["Duminica", "Luni", "Marti", "Miercuri", "Joi", "Vineri", "Sambata"];
    return zileleSaptamanii[ziua];
}

function extractComerciant(explicatie) {
  if (explicatie.includes("RO LCL")) {
        return "LCL";
    }
    if (explicatie.includes("RO COBYUL")) {
        return "COBYUL";
    }
    if (explicatie.includes("LEROY MERLIN")) {
        return "LEROY MERLIN";
    }
     if (explicatie.includes("Retail Irish Pub")) {
        return "Retail Irish Pub";
    }
     if (explicatie.includes("BlaBlaCar")) {
        return "BlaBlaCar";
    }
    if (explicatie.includes("Viva Credit")) {
        return "Viva Credit";
    }
    return "Necunoscut";
}

function categorizeTransaction(explicatie) {
    if (explicatie.includes("RO LCL")) {
        return "Magazin Alimentar";
    }
    if (explicatie.includes("RO COBYUL")) {
        return "Magazin Alimentar";
    }
    if (explicatie.includes("LEROY MERLIN")) {
        return "Casa si Gradina";
    }
    if (explicatie.includes("Retail Irish Pub")) {
        return "Divertisment";
    }
     if (explicatie.includes("BlaBlaCar")) {
        return "Transport";
    }
    if (explicatie.includes("Viva Credit")) {
        return "Altele";
    }

    return "Necunoscut";
}


// 1. Cheltuieli pe zilele saptamanii
function cheltuieliPeZileSaptamanii(tranzactii) {
    const cheltuieli = {};
    tranzactii.forEach(tranzactie => {
        if (tranzactie.debit > 0) { // Consideram doar cheltuielile
            const zi = getZiSaptamana(tranzactie.data);
            cheltuieli[zi] = (cheltuieli[zi] || 0) + tranzactie.debit;
        }
    });

    const data = Object.entries(cheltuieli).map(([name, value]) => ({ name, value }));

    return {
        title: {text: 'Cheltuieli pe zilele saptamanii'},
        tooltip: {trigger: 'item'},
        legend: {orient: 'vertical', left: 'left'},
        series: [{
            name: 'Cheltuieli',
            type: 'pie',
            radius: '50%',
            data: data,
            emphasis: {itemStyle: {shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)'}}
        }]
    };
}

// 2. Cheltuieli pe comercianti/magazine
function cheltuieliPeComercianti(tranzactii) {
    const cheltuieli = {};
    tranzactii.forEach(tranzactie => {
        if (tranzactie.debit > 0) {
            const comerciant = extractComerciant(tranzactie.explicatie);
            cheltuieli[comerciant] = (cheltuieli[comerciant] || 0) + tranzactie.debit;
        }
    });
    const data = Object.entries(cheltuieli).map(([name, value]) => ({ name, value }));

    return {
        title: {text: 'Cheltuieli pe Comercianti'},
        tooltip: {trigger: 'item'},
        legend: {orient: 'vertical', left: 'left'},
        series: [{
            name: 'Cheltuieli',
            type: 'pie',
            radius: '50%',
            data: data,
            emphasis: {itemStyle: {shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)'}}
        }]
    };
}

// 3. Total bani cheltuiti si primiti
function totalCheltuitiPrimit(tranzactii) {
    let totalCheltuiti = 0;
    let totalPrimiti = 0;

    tranzactii.forEach(tranzactie => {
        totalCheltuiti += tranzactie.debit;
        totalPrimiti += tranzactie.credit;
    });

    return {
        title: {text: 'Total Cheltuiti si Primiti'},
        tooltip: {trigger: 'item'},
        series: [{
            name: 'Suma',
            type: 'pie',
            radius: '50%',
            data: [
                {value: totalCheltuiti, name: 'Cheltuiti'},
                {value: totalPrimiti, name: 'Primiti'}
            ],
            emphasis: {itemStyle: {shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)'}}
        }]
    };
}


// 5. Impartirea cheltuielilor pe categorii
function cheltuieliPeCategorii(tranzactii) {
    const categorii = {};
    tranzactii.forEach(tranzactie => {
        if (tranzactie.debit > 0) {
            const categorie = categorizeTransaction(tranzactie.explicatie);
            categorii[categorie] = (categorii[categorie] || 0) + tranzactie.debit;
        }
    });

    const data = Object.entries(categorii).map(([name, value]) => ({ name, value }));

    return {
        title: {text: 'Cheltuieli pe Categorii'},
        tooltip: {trigger: 'item'},
        legend: {orient: 'vertical', left: 'left'},
        series: [{
            name: 'Cheltuieli',
            type: 'pie',
            radius: '50%',
            data: data,
            emphasis: {itemStyle: {shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)'}}
        }]
    };
}


// Initializare charts
const chartCheltuieliPeZile = echarts.init(document.getElementById('cheltuieliPeZile'));
const chartCheltuieliPeComercianti = echarts.init(document.getElementById('cheltuieliPeComercianti'));
const chartTotalCheltuitiPrimit = echarts.init(document.getElementById('totalCheltuitiPrimit'));
const chartPrimiriPeOrigine = echarts.init(document.getElementById('primiriPeOrigine'));
const chartCheltuieliPeCategorii = echarts.init(document.getElementById('cheltuieliPeCategorii'));


chartCheltuieliPeZile.setOption(cheltuieliPeZileSaptamanii(tranzactii));
chartCheltuieliPeComercianti.setOption(cheltuieliPeComercianti(tranzactii));
chartTotalCheltuitiPrimit.setOption(totalCheltuitiPrimit(tranzactii));
chartCheltuieliPeCategorii.setOption(cheltuieliPeCategorii(tranzactii));


</script>

</body>
</html>

